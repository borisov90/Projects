<html><head>
    <title></title>
<!-- <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.min.js" type="text/javascript"></script> -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">


<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/css/bootstrap-select.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/js/bootstrap-select.min.js"></script>

<!-- (Optional) Latest compiled and minified JavaScript translation files -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/js/i18n/defaults-*.min.js"></script> -->


<link rel="stylesheet" type="text/css" href="Scripts/jquery_ui_1.9.2.custom.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<script src="../ClientGlobalContext.js.aspx" type="text/javascript"></script>
               
<script type="text/javascript" src="Scripts/jquery.js"></script>
<script type="text/javascript" src="Scripts/jquery_ui_1.9.2.custom.js"></script>
<script type="text/javascript" src="Scripts/jqueryResize.js"></script>
<script type="text/javascript" src="Scripts/teethChild.js"></script>
<script type="text/javascript" src="Scripts/RESTJQueryContactEditor.js" ></script>

<script src="../ClientGlobalContext.js.aspx" type="text/javascript"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.min.js" type="text/javascript"></script>
<!--<script src="https://raw.githubusercontent.com/ganeshmax/jcarousellite/master/versions/jquery.jcarousellite-1.0.1.min.js" type="text/javascript"></script>-->
<script src="https://cdn.rawgit.com/ganeshmax/jcarousellite/master/versions/jquery.jcarousellite-1.0.1.min.js" type="text/javascript"></script>

<script>

function SearchCompleted(data, textStatus, XmlHttpRequest) {


            //Clear out all Contacts in the grid.

            var entityId = window.parent.Xrm.Page.data.entity.getId();


            //Re-populate the grid with results, if any
            if (data && data.length > 0) {

                //var select = document.getElementById('selectBox');

                for (var i = 0; i < data.length; i++) {


                        var idString = "" + data[i].hcr_patient_examinationId.toString();    
                        var nameString = "" + data[i].hcr_name.toString();


                       /* var option = document.createElement("option");
                        option.text = nameString;
                        select.add(option);*/

                       /* var optionToAdd = new Option(idString, nameString);
                        /// jquerify the DOM object 'o' so we can use the html method
                        $(optionToAdd).html(nameString);
                        $(".selectpicker").append(optionToAdd);*/
                         /*$(".selectpicker").selectpicker('refresh');*/
                        var optionToAdd = [
                        [idString, nameString]
                        ];

                        loadSelectBox(optionToAdd); 
                        
                        
                            //Generates all the HTML for a new row and populates
                            //it with data based on the Contact object
                }
               
                //Hide the empty message
               
            }
            //Or display the empty table message if no results
        else {

            
        }
        
      
    }

function loadSelectBox(options)
{
        var select = document.getElementById('selectBox');
        for (var i = 0; i < options.length; i++) {
            var select = document.getElementById('selectBox');
            select.options[select.options.length] = new Option(options[i][1], options[i][0], false, false);
        }
        
}

function loadFirstSelectBox(options)
{
        var select = document.getElementById('selectBoxNumberOne');
        for (var i = 0; i < options.length; i++) {
            var select = document.getElementById('selectBoxNumberOne');
            select.options[select.options.length] = new Option(options[i][1], options[i][0], false, false);
        }
        
}

function getData()
{
    console.log("Onchange was triggered");

    var selectBox = document.getElementById("selectBox");
    var selectedExaminationID = selectBox.options[selectBox.selectedIndex].value;


    var oDataQuery = clientUrl   + "/XRMServices/2011/OrganizationData.svc" +            
        "/AnnotationSet?$select=AnnotationId,Subject,DocumentBody,MimeType&" +            
        "$orderby=ModifiedOn desc&$filter=ObjectId/Id eq guid'{" + selectedExaminationID +            
        "}' and IsDocument eq true and startswith(MimeType,'image/jpeg') ";


    var carouselToCmpare = $("#carousel-To-Compare-ul");    

   

    carouselToCmpare.children().remove();

       
    


    // Execute the OData query for the images        
        $.getJSON(oDataQuery, function (data) {            
            var results = data.d.results;                        
            
            // Add the results to the carousel ul            
            for (var i = 0; i < results.length; i++) {                
                // Build up an img tag surrounded by a li tag to add to the carousel ul                
                var img = "<li><img src='";                                
 
                // set src attribute of default profile picture web resource.                                    
                // here we use DataURI schema which has 32kb limit in IE8 and doesn't support IE <= 7.                                    
                var src = "data:" + results[i].MimeType + ";base64," + results[i].DocumentBody;                                
 
                img += src;                
                img += "'class='thumbnail'   style='border: 1px solid; margin: 1px; height: 300px; width: 400px; overflow: hidden;' alt='";
                img += results[i].Subject + "'></li>";                                
 
                // Add the li with imag inside to the carousel ul                
                carouselToCmpare.append(img);
            }
 
            // Wire-up jCarouselLite to the carousel div            
            $("#carousel-To-Compare").jCarouselLite({
                btnNext: "#nextToCompare",
                btnPrev: "#prevToCompare"
            });
        });

}


function getDataToCompare()
{
    console.log("Onchange has triggered To Compare!");

    var selectBox = document.getElementById("selectBoxNumberOne");
    var selectedExaminationID = selectBox.options[selectBox.selectedIndex].value;


    var oDataQuery = clientUrl   + "/XRMServices/2011/OrganizationData.svc" +            
        "/AnnotationSet?$select=AnnotationId,Subject,DocumentBody,MimeType&" +            
        "$orderby=ModifiedOn desc&$filter=ObjectId/Id eq guid'{" + selectedExaminationID +            
        "}' and IsDocument eq true and startswith(MimeType,'image/jpeg') ";


    var carouselToCmpare = $("#carousel-ul");    

    carouselToCmpare.children().remove();

       
    


    // Execute the OData query for the images        
        $.getJSON(oDataQuery, function (data) {            
            var results = data.d.results;                        
            
            // Add the results to the carousel ul            
            for (var i = 0; i < results.length; i++) {                
                // Build up an img tag surrounded by a li tag to add to the carousel ul                
                var img = "<li><img src='";                                
 
                // set src attribute of default profile picture web resource.                                    
                // here we use DataURI schema which has 32kb limit in IE8 and doesn't support IE <= 7.                                    
                var src = "data:" + results[i].MimeType + ";base64," + results[i].DocumentBody;                                
 
                img += src;                
                img += "'class='thumbnail'   style='border: 1px solid; margin: 1px; height: 300px; width: 400px; overflow: hidden;' alt='";
                img += results[i].Subject + "'></li>";                                
 
                // Add the li with imag inside to the carousel ul                
                carouselToCmpare.append(img);
            }
 
            // Wire-up jCarouselLite to the carousel div            
            $("#carousel-To-Compare").jCarouselLite({
                btnNext: "#nextToCompare",
                btnPrev: "#prevToCompare"
            });
        });

}

 $(document).ready(function () {   

    //var context =  window.parent.Xrm.Page.context;
    var context = GetGlobalContext();  //--for 2016 
    var select = document.getElementById('selectBox');
    var optionsPleaseSelect = [['-1', 'Изберете']];



  var clientUrl = context.getClientUrl();   
    
    // Get the entity id    
    //var entityId = context.getQueryStringParameters().id;   

    var entityId = window.parent.Xrm.Page.data.entity.getId();
    //var currentPatientID = window.parent.Xrm.Page.getAttribute("new_patientLookup").getValue();
    var currentPatientID = '';
    try{
        currentPatientID = window.parent.Xrm.Page.getAttribute('hcr_patient_lookup').getValue()[0].id;
    }catch(e){
        currentPatientID = null;
    }

    //currentPatientID = currentPatientID.replace(/[{()}]/g, '');
    //var options = "$filter=new_patientLookup eq '" + currentPatientID + "'";
    var options = "new_patientLookup/Id eq guid'" + currentPatientID + "'";

    if (currentPatientID != null) {
         retrieveMultiple("hcr_patient_examinationSet", options, SearchCompleted, null);
    }


    //retrieveMultiple("hcr_dentalprofileSet", null, SearchCompleted, null);

    

    loadSelectBox(optionsPleaseSelect); 


    //var quoteId = window.parent.Xrm.Page.data.entity.getId();
    
    var entityName = window.parent.Xrm.Page.data.entity.getEntityName();
    
 
    if (entityId) {        
    
        // Build the OData query to get all the images attached to the current entity        
        var oDataQuery = clientUrl   + "/XRMServices/2011/OrganizationData.svc" +            
        "/AnnotationSet?$select=AnnotationId,Subject,DocumentBody,MimeType&" +            
        "$orderby=ModifiedOn desc&$filter=ObjectId/Id eq guid'" + entityId +            
        "' and IsDocument eq true and startswith(MimeType,'image/jpeg') ";

        //var oDataQuery = clientUrl   + "/XRMServices/2011/OrganizationData.svc/AnnotationSet?$select=Subject,Subject,DocumentBody,MimeType";      
        
        // Get a reference to the carousel ul        
        var carouselul = $("#carousel-ul");         
 
        // Execute the OData query for the images        
        $.getJSON(oDataQuery, function (data) {            
            var results = data.d.results;                        
            
            // Add the results to the carousel ul            
            for (var i = 0; i < results.length; i++) {                
                // Build up an img tag surrounded by a li tag to add to the carousel ul                
                var img = "<li><img src='";                                
 
                // set src attribute of default profile picture web resource.                                    
                // here we use DataURI schema which has 32kb limit in IE8 and doesn't support IE <= 7.                                    
                var src = "data:" + results[i].MimeType + ";base64," + results[i].DocumentBody;                                
 
                img += src;                
                img += "'class='thumbnail'   style='border: 1px solid; margin: 1px; height: 300px; width: 400px; overflow: hidden;' alt='";
                img += results[i].Subject + "'></li>";                                
 
                // Add the li with imag inside to the carousel ul                
                carouselul.append(img);
            }
 
            // Wire-up jCarouselLite to the carousel div            
            $("#carousel").jCarouselLite({
                btnNext: "#next",
                btnPrev: "#prev"
            });
        });
    } else {
        alert("could not get entity id");    
}});</script>



<meta><meta><meta><meta><meta><meta></head>

<body style="border-width: 0px; margin: 0px; padding-left: 0px; padding-top: 0px; word-wrap: break-word; background-color: rgb(246, 248, 250);">
<form>
<!-- class="selectpicker show-tick" -->
     <select id="selectBox" onchange="getData()">               
    </select>
    

</form>
    <table class="container">
        <tbody><tr>
            <td>
                <button id="prev" class="btn btn-primary">Предишна</button>
                <button id="next" class="btn btn-primary">Следваща</button>

            </td>
        </tr>
        <tr>
            <td>
                <div id="carousel">
                    <ul id="carousel-ul">
                    </ul>
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <button id="prevToCompare" class="btn btn-primary">Предишна</button>
                <button id="nextToCompare" class="btn btn-primary">Следваща</button>

            </td>
            
        </tr>
        <tr>  
            <td>
                <div id="carousel-To-Compare">
                    <ul id="carousel-To-Compare-ul">
                    </ul>
                </div>
            </td>  
        </tr>
    </tbody></table>








</body></html>